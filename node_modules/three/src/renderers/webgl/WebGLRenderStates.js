import { WebGLLights } from './WebGLLights.js';

<<<<<<< HEAD
function WebGLRenderState( extensions ) {

	const lights = new WebGLLights( extensions );
=======
function WebGLRenderState( extensions, capabilities ) {

	const lights = new WebGLLights( extensions, capabilities );
>>>>>>> 727212f0e41d07239440c089797281762dea0630

	const lightsArray = [];
	const shadowsArray = [];

<<<<<<< HEAD
	function init( camera ) {

		state.camera = camera;
=======
	function init() {
>>>>>>> 727212f0e41d07239440c089797281762dea0630

		lightsArray.length = 0;
		shadowsArray.length = 0;

	}

	function pushLight( light ) {

		lightsArray.push( light );

	}

	function pushShadow( shadowLight ) {

		shadowsArray.push( shadowLight );

	}

	function setupLights( useLegacyLights ) {

		lights.setup( lightsArray, useLegacyLights );

	}

	function setupLightsView( camera ) {

		lights.setupView( lightsArray, camera );

	}

	const state = {
		lightsArray: lightsArray,
		shadowsArray: shadowsArray,

<<<<<<< HEAD
		camera: null,

		lights: lights,

		transmissionRenderTarget: {}
=======
		lights: lights
>>>>>>> 727212f0e41d07239440c089797281762dea0630
	};

	return {
		init: init,
		state: state,
		setupLights: setupLights,
		setupLightsView: setupLightsView,

		pushLight: pushLight,
		pushShadow: pushShadow
	};

}

<<<<<<< HEAD
function WebGLRenderStates( extensions ) {
=======
function WebGLRenderStates( extensions, capabilities ) {
>>>>>>> 727212f0e41d07239440c089797281762dea0630

	let renderStates = new WeakMap();

	function get( scene, renderCallDepth = 0 ) {

		const renderStateArray = renderStates.get( scene );
		let renderState;

		if ( renderStateArray === undefined ) {

<<<<<<< HEAD
			renderState = new WebGLRenderState( extensions );
=======
			renderState = new WebGLRenderState( extensions, capabilities );
>>>>>>> 727212f0e41d07239440c089797281762dea0630
			renderStates.set( scene, [ renderState ] );

		} else {

			if ( renderCallDepth >= renderStateArray.length ) {

<<<<<<< HEAD
				renderState = new WebGLRenderState( extensions );
=======
				renderState = new WebGLRenderState( extensions, capabilities );
>>>>>>> 727212f0e41d07239440c089797281762dea0630
				renderStateArray.push( renderState );

			} else {

				renderState = renderStateArray[ renderCallDepth ];

			}

		}

		return renderState;

	}

	function dispose() {

		renderStates = new WeakMap();

	}

	return {
		get: get,
		dispose: dispose
	};

}


export { WebGLRenderStates };
